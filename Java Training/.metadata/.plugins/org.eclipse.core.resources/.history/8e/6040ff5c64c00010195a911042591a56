package com.restapiproject.hotelMgmt.repository;

import java.sql.PreparedStatement;
import java.sql.Statement;
import java.sql.Timestamp;
import java.util.List;
import java.util.Optional;

import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.jdbc.support.GeneratedKeyHolder;
import org.springframework.jdbc.support.KeyHolder;

import com.restapiproject.hotelMgmt.model.Hotel;

public class HotelDaoImpl implements HotelDao {

	private final JdbcTemplate jdbcTemplate;

	public HotelDaoImpl(JdbcTemplate jdbcTemplate) {
		this.jdbcTemplate = jdbcTemplate;
	}

	@Override
	public Hotel save(Hotel hotel) {
		String sql = "insert into hotels(id, name, address,total_rooms, available_rooms,\n "
				+ "price_per_night, created_at, updated_at) values (?,?,?,?,?,?,?,?)";
		KeyHolder keyholder = new GeneratedKeyHolder();
		int updated = jdbcTemplate.update(con -> {
			PreparedStatement ps = con.prepareStatement(sql, Statement.RETURN_GENERATED_KEYS);
			ps.setLong(1, hotel.getId());
			ps.setString(2, hotel.getName());
			ps.setString(3, hotel.getAddress());
			ps.setInt(4, hotel.getTotal_rooms());
			ps.setInt(5, hotel.getAvailable_rooms());
			ps.setBigDecimal(6, hotel.getPrice_per_night());
			return ps;
		}, keyholder);

		Number key = keyholder.getKey();
		if (key != null) {
			hotel.setId(key.longValue());
		}
		
		if (updated > 0) {
			System.out.println("Hotel is created");
		} else {
			System.out.println("Cannot add a new hotel ");
		}
		return hotel;
	}

	@Override
	public Optional<Hotel> findById(Long id) {
		// TODO Auto-generated method stub
		return null;
	}

	@Override
	public List<Hotel> findAll() {
		// TODO Auto-generated method stub
		return null;
	}

	@Override
	public int update(Hotel hotel) {
		// TODO Auto-generated method stub
		return 0;
	}

	@Override
	public int deleteById(Long id) {
		// TODO Auto-generated method stub
		return 0;
	}

}
