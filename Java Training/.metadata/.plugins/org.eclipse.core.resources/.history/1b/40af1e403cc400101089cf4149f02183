//Promises - async, fetch, try...catch

//JavaScript - single threaded - it can do only one thing at a time

// many tasks consumes time :
//fetch data from server API calls;
//Reading files
//DB Ops
//large processing

//If JS waited - blocked for all such tasks - browser will freeze

//JS uses asynchronous programming -  it can let slow tasks run in the background 
//		while rest of the code can continue

//Implement this - promises - async, await, fetch, try...catch

//PROMISE : 
	//represent a value that will be available now , later or never.
	//3 states :
		//a. pending - running
		//b. fulfilled - success.
		//c. rejected - failure
	//handle slow operations without blocking program
	
	
	
	/*
	
	
	new Promise((resolve, reject))
	
	fetch() : browser API, promise based for calling servers
			: call URLs / APIs - GET , POST, PUT, DELETE
			: returns a Promise
			
	fetch("http://abc/qwe")
	.then(response.......)
	.then(data........)
	.catch(err...)
	
	async /await :
	
	async -> makes a function asynchronous 
	await -> waits for the promise to finish (inside async function only)
	more better or more cleaner way to use promises
	
	
	async function getData(){
		const result = await fetch("/////////////");
		const data = await result.json();
	}
	
	try/ catch :
	async function getData2(){
		try{
			const result = await fetch("..............");
			const data = await result.json();
		}catch(err){
			
		}
	}
	
	Promise = long async work like API
	fetch - API call
	async/await - cleaner
	
	*/
	
	
// ELement reference
const btnLoad = document.getElementById("btnLoad");
const statusE1 = document.getElementById("status");
const usersList = document.getElementById("usersList");
const reusltE1 = document.getElementById("addForm");

const API_Base = "https://jsonplaceholder.typicode.com";

function appendUser(user){
	const li = document.createElement("li");
	li.textContent= `${user.id ? user.id + " - " :''} ${user.name} (${user.email})`;
	usersList.append(li);
}


async function fetchUsers(){
	setStatus('loading users ...');
	try{
		//fetch - return promise - resolve to a response object
		const response = await fetch(`{API_base}/users`);		//GET by default
		//check for http status
		if(response.ok){
			throw new Error(`server response with ${resonse.status} ${response.statusText}`);
		}
		// return promise
		const users = await response.json();
		
		//clear previous list
		usersList.innerHTML='';
		users.forEach(user=> appendUser(user));
		setStatus(`Loaded ${users.length} users`);
	}catch(error){
		console.error('fetchedUsers : ', error);
	}
}





	